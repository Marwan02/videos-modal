/**
 * Videos Modal Plugin https://github.com/hello-motto
 * 
 * Version 1.0.3
 * 
 * @author Jean-Baptiste MOTTO <contact@hello-motto.fr>
 */
class VideosModal{constructor(t={}){return this.onClick=function(t){t.preventDefault();var e=t.target,i=e.getAttribute("data-videos-modal-provider");!this.isTarteAuCitronEnabled()||this.isProviderAllowedByTarteAuCitron(i)?this.open(e):this.options.tarteAuCitron.userInterface.openPanel()},this.clickHandler=this.onClick.bind(this),this.init(t,!1),this}init(t,e){for(var i in!0!==e&&(this.setDefaultOptions(),this.setVideosModalContainer()),t)void 0!==this.options[i]&&(this.options[i]=t[i]);return this.setLinks(),this.initEvents(e),this}initEvents(t){var e,i=this;for(!0!==t&&(window.addEventListener?window.addEventListener("keydown",function(t){i.onkeydown(t)},!1):window.attachEvent("onkeydown",function(t){i.onkeydown(t)}),!0===i.options.closeByIcon&&document.getElementById("videos-modal-close").addEventListener("click",function(){i.close()}),!0===this.options.closeOnClick&&document.getElementById("videos-modal-background").addEventListener("click",function(){i.close()})),e=0;e<i.linksNumber;e++)!0===i.options.navigate&&i.linksNumber>1&&i.links[e].setAttribute("data-videos-modal-order",e),i.links[e].addEventListener("click",i.clickHandler,!1);return this}setLinks(){return this.currentLink=0,this.links=document.querySelectorAll(this.options.links),this.linksNumber=this.links.length,this}reset(){for(var t=this.links,e=0;e<this.linksNumber;e++)t[e].removeEventListener("click",this.clickHandler);return this.init(this.options,!0)}setDefaultOptions(){this.options=[],this.options.closeOnClick=!0,this.options.closeWithEscape=!0,this.options.closeByIcon=!0,this.options.closeIcon=!0===this.options.closeByIcon?this.getDefaultCloseIcon():null,this.options.loading=!0,this.options.loaderIcon=!0===this.options.loading?this.getDefaultLoaderIcon():null,this.options.navigate=!0,this.options.leftArrow=!0===this.options.navigate?this.getDefaultLeftArrow():null,this.options.rightArrow=!0===this.options.navigate?this.getDefaultRightArrow():null,this.options.tarteAuCitron=null,this.options.links=".videos-modal-link",this.options.videos_provider=null,this.options.videos_id=null,this.options.videos_width=null,this.options.videos_height=null,this.options.videos_autoplay=0,this.options.videos_rel=0,this.options.videos_controls=0,this.options.videos_showinfo=0,this.options.videos_allowfullscreen=0,this.options.videos_title=!0,this.options.videos_byline=!0,this.options.videos_portrait=!0,this.options.videos_loop=!1}open(t){var e=this,i=document.getElementById("videos-modal"),s=t.getAttribute("data-videos-modal-provider");if(i.classList.add("opened"),i.appendChild(e.getVideoTemplate(t)),e.isProviderAllowedByTarteAuCitron(s)&&e.options.tarteAuCitron.services[s].js(),!0===e.options.navigate&&e.linksNumber>1){e.currentLink=parseInt(t.getAttribute("data-videos-modal-order"));var o=e.createLink(e.getPrevLink());o.setAttribute("id","videos-modal-prev-link"),o.addEventListener("click",function(t){t.preventDefault(),e.prev()}),o.insertAdjacentHTML("afterbegin",e.options.leftArrow);var n=e.createLink(e.getNextLink());n.setAttribute("id","videos-modal-next-link"),n.addEventListener("click",function(t){t.preventDefault(),e.next()}),n.insertAdjacentHTML("afterbegin",e.options.rightArrow),i.appendChild(o),i.appendChild(n)}return this}close(){return document.getElementById("videos-modal").classList.remove("opened"),this.removeVideoContainer(),this.removeNavigationLinks(),this}prev(){var t=document.getElementById("videos-modal-prev-link");return this.updateNavigationLinks(t),this}next(){var t=document.getElementById("videos-modal-next-link");return this.updateNavigationLinks(t),this}updateNavigationLinks(t){var e=t.getAttribute("data-videos-modal-provider"),i=document.getElementById("videos-modal"),s=document.getElementById("videos-modal-prev-link"),o=document.getElementById("videos-modal-next-link");if(!this.isTarteAuCitronEnabled()||this.isProviderAllowedByTarteAuCitron(e)){var n=this.getVideoTemplate(t);this.currentLink=parseInt(t.getAttribute("data-videos-modal-order")),this.removeVideoContainer(),this.editLink(s,this.getPrevLink()),this.editLink(o,this.getNextLink()),i.appendChild(n),this.isProviderAllowedByTarteAuCitron(e)&&this.options.tarteAuCitron.services[e].js()}else this.close(),this.options.tarteAuCitron.userInterface.openPanel();return this}getLinks(){return document.querySelectorAll(this.options.links)}getLink(t){return this.getLinks()[t]}getCurrentLink(){return this.getLinks()[this.currentLink]}getPrevLink(){var t=this.currentLink>0?this.currentLink-1:this.linksNumber-1;return this.getLink(t)}getNextLink(){var t=this.currentLink===this.linksNumber-1?0:this.currentLink+1;return this.getLink(t)}removeNavigationLinks(){var t,e=document.getElementById("videos-modal").getElementsByTagName("a");for(t=e.length-1;t>=0;t--)e[t].parentNode.removeChild(e[t]);return this}getCloseIcon(){return this.options.closeIcon}getLoaderIcon(){return this.options.loaderIcon}getVideoTemplate(t){var e,i,s,o=this.setTemplateLinkValues(t,"provider"),n=this.setTemplateLinkValues(t,"width",.7*window.innerWidth),r=this.setTemplateLinkValues(t,"height",.7*window.innerHeight),a=this.setTemplateLinkValues(t,"autoplay"),l=this.setTemplateLinkValues(t,"rel"),d=this.setTemplateLinkValues(t,"controls"),u=this.setTemplateLinkValues(t,"showinfo"),h=this.setTemplateLinkValues(t,"allowfullscreen"),c=parseInt((window.innerHeight-r)/2)+"px",v=this.setTemplateLinkValues(t,"title"),m=this.setTemplateLinkValues(t,"byline"),p=this.setTemplateLinkValues(t,"portrait"),g=this.setTemplateLinkValues(t,"loop");switch(o){case"youtube":i="//www.youtube.com/embed/"+(e=this.setTemplateLinkValues(t,"id","Q5fftru-t-g"))+"?&autoplay="+a;break;case"dailymotion":i="//www.dailymotion.com/embed/video/"+(e=this.setTemplateLinkValues(t,"id","xta4r"))+"?info="+u+"&autoPlay="+a;break;case"vimeo":i="//player.vimeo.com/video/"+(e=this.setTemplateLinkValues(t,"id","210806913"))+"?autoplay"+a,i+="&title="+v,i+="&byline="+m,i+="&portrait="+p,i+="&loop="+g}return this.isTarteAuCitronEnabled()&&this.isProviderAllowedByTarteAuCitron(o)?((s=document.createElement("div")).classList.add(o+"_player"),s.setAttribute("videoID",e),s.setAttribute("rel",l),s.setAttribute("controls",d),s.setAttribute("showinfo",u),s.setAttribute("allowfullscreen",h),s.setAttribute("autoplay",a),s.setAttribute("title",v),s.setAttribute("loop",g),s.setAttribute("byline",m),s.setAttribute("portrait",p)):((s=document.createElement("iframe")).setAttribute("src",i),s.setAttribute("frameborder",0)),s.setAttribute("allowfullscreen",h),s.setAttribute("width",n),s.setAttribute("height",r),s.classList.add("videos_player"),s.style.marginTop=c,s}createLink(t){var e=document.createElement("a");return this.editLink(e,t),e}editLink(t,e){return t.setAttribute("data-videos-modal-order",e.getAttribute("data-videos-modal-order")),t.setAttribute("data-videos-modal-id",this.getLinkAttribute(e,"id")),t.setAttribute("data-videos-modal-provider",this.getLinkAttribute(e,"provider")),t.setAttribute("data-videos-modal-width",this.getLinkAttribute(e,"width")),t.setAttribute("data-videos-modal-height",this.getLinkAttribute(e,"height")),t.setAttribute("data-videos-modal-autoplay",this.getLinkAttribute(e,"autoplay")),t.setAttribute("data-videos-modal-rel",this.getLinkAttribute(e,"rel")),t.setAttribute("data-videos-modal-controls",this.getLinkAttribute(e,"controls")),t.setAttribute("data-videos-modal-showinfo",this.getLinkAttribute(e,"showinfo")),t.setAttribute("data-videos-modal-allowfullscreen",this.getLinkAttribute(e,"allowfullscreen")),t.setAttribute("data-videos-modal-title",this.getLinkAttribute(e,"title")),t.setAttribute("data-videos-modal-byline",this.getLinkAttribute(e,"byline")),t.setAttribute("data-videos-modal-portrait",this.getLinkAttribute(e,"portrait")),t.setAttribute("data-videos-modal-loop",this.getLinkAttribute(e,"loop")),this}setVideosModalContainer(){var t=document.getElementById("videos-modal");null===t&&(t=document.createElement("div")).setAttribute("id","videos-modal"),!0===this.options.closeByIcon&&t.insertAdjacentHTML("beforeend",this.getCloseIcon()),!0===this.options.loading&&t.insertAdjacentHTML("beforeend",this.getLoaderIcon()),document.body.appendChild(t);var e=document.createElement("div");return e.setAttribute("id","videos-modal-background"),t.appendChild(e),this}removeVideoContainer(){var t,e=document.getElementById("videos-modal").getElementsByClassName("videos_player");for(t=e.length-1;t>=0;t--)e[t].parentNode.removeChild(e[t]);return this}isTarteAuCitronEnabled(){return null!==this.options.tarteAuCitron}isProviderAllowedByTarteAuCitron(t){var e=this.options.tarteAuCitron;if(this.isTarteAuCitronEnabled())switch(t){case"youtube":case"dailymotion":case"vimeo":return!1!==e.state[t]}return!1}setTemplateLinkValues(t,e,i=null){return void 0!==t.getAttribute("data-videos-modal-"+e)&&null!==t.getAttribute("data-videos-modal-"+e)&&"null"!==t.getAttribute("data-videos-modal-"+e)?t.getAttribute("data-videos-modal-"+e):null!==this.options["videos_"+e]?this.options["videos_"+e]:i}getLinkAttribute(t,e){return null!==t.getAttribute("data-videos-modal-"+e)?t.getAttribute("data-videos-modal-"+e):this.options["videos_"+e]}onkeydown(t){if(document.getElementById("videos-modal").classList.contains("opened"))switch(t.keyCode||t.which){case 27:!0===this.options.closeWithEscape&&this.close();break;case 37:!0===this.options.navigate&&this.linksNumber>1&&this.prev();break;case 39:!0===this.options.navigate&&this.linksNumber>1&&this.next()}}getDefaultLoaderIcon(){return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" class="videos-modal-loader"><rect x="47" y="22.5" rx="9.4" ry="4.5" width="6" height="15" fill="#fff" transform="rotate(0 50 50)"><animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.875s" repeatCount="indefinite"/></rect><rect x="47" y="22.5" rx="9.4" ry="4.5" width="6" height="15" fill="#fff" transform="rotate(45 50 50)"><animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.75s" repeatCount="indefinite"/></rect><rect x="47" y="22.5" rx="9.4" ry="4.5" width="6" height="15" fill="#fff" transform="rotate(90 50 50)"><animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.625s" repeatCount="indefinite"/></rect><rect x="47" y="22.5" rx="9.4" ry="4.5" width="6" height="15" fill="#fff" transform="rotate(135 50 50)"><animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.5s" repeatCount="indefinite"/></rect><rect x="47" y="22.5" rx="9.4" ry="4.5" width="6" height="15" fill="#fff" transform="rotate(180 50 50)"><animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.375s" repeatCount="indefinite"/></rect><rect x="47" y="22.5" rx="9.4" ry="4.5" width="6" height="15" fill="#fff" transform="rotate(225 50 50)"><animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.25s" repeatCount="indefinite"/></rect><rect x="47" y="22.5" rx="9.4" ry="4.5" width="6" height="15" fill="#fff" transform="rotate(270 50 50)"><animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.125s" repeatCount="indefinite"/></rect><rect x="47" y="22.5" rx="9.4" ry="4.5" width="6" height="15" fill="#fff" transform="rotate(315 50 50)"><animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="0s" repeatCount="indefinite"/></rect></svg>'}getDefaultCloseIcon(){return'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" id="videos-modal-close"viewBox="0 0 32 32" style="enable-background:new 0 0 32 32;" xml:space="preserve"><path fill="#999" d="M30.3448276,31.4576271 C29.9059965,31.4572473 29.4852797,31.2855701 29.1751724,30.980339 L0.485517241,2.77694915 C-0.122171278,2.13584324 -0.104240278,1.13679247 0.52607603,0.517159487 C1.15639234,-0.102473494 2.17266813,-0.120100579 2.82482759,0.477288136 L31.5144828,28.680678 C31.9872448,29.1460053 32.1285698,29.8453523 31.8726333,30.4529866 C31.6166968,31.0606209 31.0138299,31.4570487 30.3448276,31.4576271 Z" /><path fill="#999" d="M1.65517241,31.4576271 C0.986170142,31.4570487 0.383303157,31.0606209 0.127366673,30.4529866 C-0.12856981,29.8453523 0.0127551942,29.1460053 0.485517241,28.680678 L29.1751724,0.477288136 C29.8273319,-0.120100579 30.8436077,-0.102473494 31.473924,0.517159487 C32.1042403,1.13679247 32.1221713,2.13584324 31.5144828,2.77694915 L2.82482759,30.980339 C2.51472031,31.2855701 2.09400353,31.4572473 1.65517241,31.4576271 Z" /></svg>'}getDefaultLeftArrow(){return'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" class="videos-modal-left-arrow" viewBox="0 0 11.4 20" style="enable-background:new 0 0 11.4 20;" xml:space="preserve"><path fill="#999" d="M0.4,9L9,0.4c0.5-0.5,1.4-0.5,2,0c0.5,0.5,0.5,1.4,0,2L3.4,10l7.6,7.6c0.5,0.5,0.5,1.4,0,2 c-0.5,0.5-1.4,0.5-2,0L0.4,11C-0.2,10.4-0.2,9.6,0.4,9L0.4,9L0.4,9z"/></svg>'}getDefaultRightArrow(){return'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" class="videos-modal-right-arrow" viewBox="0 0 11.4 20" style="enable-background:new 0 0 11.4 20;" xml:space="preserve"><path fill="#999" d="M11,11l-8.6,8.6c-0.5,0.5-1.4,0.5-2,0c-0.5-0.5-0.5-1.4,0-2L8,10L0.4,2.4c-0.5-0.5-0.5-1.4,0-2 c0.5-0.5,1.4-0.5,2,0L11,9C11.5,9.6,11.5,10.4,11,11C11,11,11,11,11,11L11,11z"/></svg>'}}